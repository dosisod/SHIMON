<html>
<head>
<meta name="viewport" content="width=device-width">
<title>SHIMON</title>
<link rel="stylesheet" href={{ url_for("static", filename="font.css") }}>
{% include "msg.css" %}
{% include "ui.css" %}

</head>
<body>

<div class="container">
<ol class="content" id="tray">
	{% include "sidebar.html" %}
	<span class="center name point" id="reload" onclick="reload_msgs()">RELOAD</span>
</ol>
{% include "error-msg.html" %}
<input id="typer" placeholder="Type away!" onkeydown="send(event)"></input>
</div>

{% include "headers.html" %}

<script>
url("msg/"+document.cookie.replace(/(?:(?:^|.*;\s*)uname\s*\=\s*([^;]*).*$)|^.*$/, "$1")) //set url

preload={{ preload|default("false")|safe() }}
friends={{ friends|default("false")|safe() }}

reload_msgs() //reload

setInterval(reload_msgs, 5000) //reload again every 5 seconds

async function send(e) { //send msg to user
	//only send if enter was pressed
	if (e.key!="Enter"||!e.target.value) return

	//wait for message to send before procceding
	await post({"send msg":{
		"uname": document.cookie.replace(/(?:(?:^|.*;\s*)uname\s*\=\s*([^;]*).*$)|^.*$/, "$1"),
		"msg": e.target.value
	}}).then(e=>{
		if (e.code!=400) {
			//reload and scroll to bottom of page if msg was valid
			reload_msgs()
		}
	})

	e.target.value="" //reset input box
}

</script>

</body>
</html>