<html>
<head>
<meta name="viewport" content="width=device-width">
<title>SHIMON</title>
<link rel="stylesheet" href={{ url_for("static", filename="font.css") }}>
{% include "msg.css" %}
{% include "ui.css" %}

</head>
<body>

<div class="container">
<ol class="content" id="tray">
	{% include "sidebar.html" %}
	<span class="center name point" id="reload" onclick="reload_msgs()">RELOAD</span>
</ol>
<span class="warn error" id="error"></span>
<input id="typer" onkeydown="send(event)"></input>
</div>

{% include "headers.html" %}

<script>
url("msg/"+document.cookie.replace(/(?:(?:^|.*;\s*)uname\s*\=\s*([^;]*).*$)|^.*$/, "$1")) //set url

reload_msgs() //reload

setInterval(reload_msgs, 5000) //reload again every 5 seconds

async function send(e) { //send msg to user
	//only send if enter was pressed
	if (e.key!="Enter") return

	//wait for message to send before procceding
	await post({"send msg":{
		"uname": document.cookie.replace(/(?:(?:^|.*;\s*)uname\s*\=\s*([^;]*).*$)|^.*$/, "$1"),
		"msg": e.target.value
	}})

	//reload and scroll to bottom of page
	reload_msgs()
	window.scrollTo(0, document.body.scrollHeight || document.documentElement.scrollHeight)

	e.target.value="" //reset input box
}

</script>

</body>
</html>